{"mappings":"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","sources":["src/scripts/utils.js","src/scripts/app.js","src/scripts/mouse.js","src/scripts/map.js"],"sourcesContent":["'use strict';\r\n\r\nfunction buildKey(...keys) {\r\n    return keys.sort((a, b) => {\r\n        if (isNaN(a)) {\r\n            if (isNaN(b)) {\r\n                return String(a).localeCompare(b);\r\n            } else {\r\n                return -1;\r\n            }\r\n        } else {\r\n            if (isNaN(b)) {\r\n                return 1;\r\n            } else {\r\n                return a - b;\r\n            }\r\n        }\r\n    }).join('-');\r\n}\r\n\r\nfunction swap(set, ...keys) {\r\n    let key = buildKey(...keys);\r\n    if (!set.delete(key)) {\r\n        set.add(key);\r\n    }\r\n}\r\n\r\nmodule.exports = {buildKey, swap};","'use strict';\r\n\r\nimport {Map} from \"./map\";\r\nimport {Mouse} from \"./mouse\";\r\n\r\nconst STATE_MAIN_MENU = \"MAIN_MENU\";\r\nconst STATE_CONSTRUCTION_MAP = \"CONSTRUCTION_MAP\";\r\nconst STATE_CONSTRUCTION_MOUSE = \"CONSTRUCTION_MOUSE\";\r\nconst STATE_CONSTRUCTION_CHEESE = \"CONSTRUCTION_CHEESE\";\r\nconst STATE_PROGRAM_ROUTE = \"PROGRAM_ROUTE\";\r\nconst STATE_PLAY_ROUTE = \"PLAY_ROUTE\";\r\n\r\nconst MAP_SIZE = 10;\r\n\r\nlet divMap = document.getElementById('map');\r\nlet divProgramPanel = document.getElementById('programPanel');\r\nlet imgMouse = document.getElementById('mouse');\r\nlet imgCheese = document.getElementById('cheese');\r\n\r\nlet gameState = STATE_MAIN_MENU;\r\nlet program = [];\r\nlet cheese = [-1, -1];\r\nlet originalPosition = [-1, -1];\r\nlet mouse = new Mouse(function (column, row, direction) {\r\n    let rect = document.getElementById('movingArea').getBoundingClientRect();\r\n    imgMouse.style.top = (row + 0.5) * (rect.height / MAP_SIZE) + 'px';\r\n    imgMouse.style.left = (column + 0.5) * (rect.width / MAP_SIZE) + 'px';\r\n    imgMouse.style.display = 'initial';\r\n    if (direction === 'UP') {\r\n        imgMouse.style.transform = 'rotate(180deg)';\r\n    } else if (direction === 'DN') {\r\n        imgMouse.style.transform = 'rotate(0deg)';\r\n    } else if (direction === 'LT') {\r\n        imgMouse.style.transform = 'rotate(90deg)';\r\n    } else if (direction === 'RT') {\r\n        imgMouse.style.transform = 'rotate(270deg)';\r\n    }\r\n});\r\nlet map = new Map(MAP_SIZE, function (column, row, state, rightBorderState, bottomBorderState) {\r\n    let cell = divMap.children[row * MAP_SIZE + column];\r\n    if (state) {\r\n        cell.classList.add('land');\r\n    } else {\r\n        cell.classList.remove('land');\r\n    }\r\n\r\n    if (rightBorderState) {\r\n        cell.classList.add('rb');\r\n    } else {\r\n        cell.classList.remove('rb');\r\n    }\r\n\r\n    if (bottomBorderState) {\r\n        cell.classList.add('bb');\r\n    } else {\r\n        cell.classList.remove('bb');\r\n    }\r\n});\r\n\r\nfor (let i = 0; i < MAP_SIZE * MAP_SIZE; i++) {\r\n    let cellDiv = document.createElement('div');\r\n    cellDiv.className = \"cell\";\r\n    divMap.appendChild(cellDiv);\r\n}\r\n\r\ndocument.getElementById('btnMM').addEventListener('click', toMainMenu);\r\ndocument.getElementById('btnBuildLevel').addEventListener('click', setState.bind(this, STATE_CONSTRUCTION_MAP));\r\ndocument.getElementById('btnPutCheese').addEventListener('click', setState.bind(this, STATE_CONSTRUCTION_CHEESE));\r\ndocument.getElementById('btnPutMouse').addEventListener('click', setState.bind(this, STATE_CONSTRUCTION_MOUSE));\r\ndocument.getElementById('btnPlay').addEventListener('click', resetProgram);\r\ndocument.getElementById('btnReset').addEventListener('click', resetProgram);\r\ndocument.getElementById('btnGo').addEventListener('click', playProgram);\r\n\r\ndocument.getElementById('btnUp').addEventListener('click', event => addCommand('UP', event));\r\ndocument.getElementById('btnLeft').addEventListener('click', event => addCommand('LT', event));\r\ndocument.getElementById('btnRight').addEventListener('click', event => addCommand('RT', event));\r\ndocument.getElementById('btnDown').addEventListener('click', event => addCommand('DN', event));\r\ndocument.getElementById('btnRemoveLast').addEventListener('click', removeLastCommand);\r\n\r\ndocument.getElementById('movingArea').addEventListener('click', onMapClick);\r\n\r\nonStateChanged(gameState);\r\n\r\nfunction onMapClick(e) {\r\n    let rect = divMap.getBoundingClientRect();\r\n    let x = e.clientX - rect.left;\r\n    let y = e.clientY - rect.top;\r\n    let cellX = x / (rect.width / MAP_SIZE);\r\n    let cellY = y / (rect.height / MAP_SIZE);\r\n\r\n    console.log(\"X? : \" + x + \" ; Y? : \" + y);\r\n    console.log(\"cellX? : \" + cellX + \" ; cellY? : \" + cellY);\r\n\r\n    let column = Math.trunc(cellX);\r\n    let row = Math.trunc(cellY);\r\n\r\n    console.log(\"col? : \" + column + \" ; row? : \" + row);\r\n\r\n    if (gameState === STATE_CONSTRUCTION_MAP) {\r\n        console.log('change map');\r\n        if (Math.abs(Math.round(cellX) - cellX) < 0.1 && Math.abs(Math.round(cellY) - cellY) < 0.1) {\r\n            //do nothing\r\n        } else if (Math.abs(Math.round(cellX) - cellX) < 0.1) {\r\n            if (cellX > 0 && cellX - column < 0.5) {\r\n                map.swapRightBorder(row, column - 1, column);\r\n            } else if (cellX < (MAP_SIZE - 1) && cellX - column > 0.5) {\r\n                map.swapRightBorder(row, column, column + 1);\r\n            }\r\n        } else if (Math.abs(Math.round(cellY) - cellY) < 0.1) {\r\n            if (cellY > 0 && cellY - row < 0.5) {\r\n                map.swapBottomBorder(column, row - 1, row);\r\n            } else if (cellY < (MAP_SIZE - 1) && cellY - row > 0.5) {\r\n                map.swapBottomBorder(column, row, row + 1);\r\n            }\r\n        } else {\r\n            map.swapCell(column, row);\r\n        }\r\n    } else if (gameState === STATE_CONSTRUCTION_CHEESE) {\r\n        console.log('change cheese position');\r\n        if (map.isLand(column, row)) {\r\n            let rect = document.getElementById('movingArea').getBoundingClientRect();\r\n            cheese = [column, row];\r\n            imgCheese.style.display = 'initial';\r\n            imgCheese.style.top = (row + 0.5) * (rect.height / MAP_SIZE) + 'px';\r\n            imgCheese.style.left = (column + 0.5) * (rect.width / MAP_SIZE) + 'px';\r\n        }\r\n        onStateChanged(STATE_CONSTRUCTION_CHEESE);\r\n    } else if (gameState === STATE_CONSTRUCTION_MOUSE) {\r\n        console.log('change mouse position');\r\n        if (map.isLand(column, row)) {\r\n            originalPosition = [column, row];\r\n            mouse.put(column, row, 'UP');\r\n        }\r\n        onStateChanged(STATE_CONSTRUCTION_MOUSE);\r\n    }\r\n}\r\n\r\nfunction addCommand(commandName, e) {\r\n    if (program.length === 0) {\r\n        mouse.put(originalPosition[0], originalPosition[1], commandName);\r\n    }\r\n    program.push(commandName);\r\n    let img = document.createElement('img');\r\n    img.src = e.target.src ? e.target.src : e.target.children[0].src;\r\n    divProgramPanel.appendChild(img);\r\n}\r\n\r\nfunction removeLastCommand() {\r\n    if (program.length > 0) {\r\n        program.pop();\r\n        divProgramPanel.removeChild(divProgramPanel.children[divProgramPanel.children.length - 1]);\r\n    }\r\n}\r\n\r\nfunction toMainMenu() {\r\n    program = [];\r\n    cheese = [-1, -1];\r\n    originalPosition = [-1, -1];\r\n    divProgramPanel.innerHTML = '';\r\n    map.clear();\r\n    setState(STATE_MAIN_MENU);\r\n}\r\n\r\nfunction resetProgram() {\r\n    program = [];\r\n    divProgramPanel.innerHTML = '';\r\n    mouse.put(originalPosition[0], originalPosition[1], 'UP');\r\n    setState(STATE_PROGRAM_ROUTE);\r\n}\r\n\r\nfunction playProgram() {\r\n    mouse.play(map, cheese, program, function () {\r\n        alert('Win');\r\n        resetProgram();\r\n    }, function () {\r\n        alert('Lose');\r\n        resetProgram();\r\n    });\r\n}\r\n\r\nfunction onStateChanged(newState) {\r\n    console.log('onStateChanged');\r\n\r\n    document.getElementById('btnMM').style.visibility = 'visible';\r\n    document.getElementById('btnBuildLevel').style.display = [STATE_MAIN_MENU].indexOf(newState) < 0 ? 'none' : 'initial';\r\n    document.getElementById('btnPutCheese').style.display = [STATE_CONSTRUCTION_MAP].indexOf(newState) < 0 ? 'none' : 'initial';\r\n    document.getElementById('btnPutMouse').style.display = [STATE_CONSTRUCTION_CHEESE].indexOf(newState) < 0 ? 'none' : 'initial';\r\n    document.getElementById('btnPlay').style.display = [STATE_CONSTRUCTION_MOUSE].indexOf(newState) < 0 ? 'none' : 'initial';\r\n    document.getElementById('btnReset').style.display = [STATE_PROGRAM_ROUTE, STATE_PLAY_ROUTE].indexOf(newState) < 0 ? 'none' : 'initial';\r\n    document.getElementById('btnGo').style.display = [STATE_PROGRAM_ROUTE].indexOf(newState) < 0 ? 'none' : 'initial';\r\n\r\n    let controlBtns = document.getElementsByClassName('control-btns');\r\n    Array.from(controlBtns).forEach(el => el.disabled = newState !== STATE_PROGRAM_ROUTE);\r\n\r\n    document.getElementById('cheese').style.display = (cheese[0] === -1 || [STATE_CONSTRUCTION_CHEESE, STATE_CONSTRUCTION_MOUSE, STATE_PROGRAM_ROUTE, STATE_PLAY_ROUTE].indexOf(newState) < 0) ? 'none' : 'initial';\r\n    document.getElementById('mouse').style.display = (originalPosition[0] === -1 || [STATE_CONSTRUCTION_MOUSE, STATE_PROGRAM_ROUTE, STATE_PLAY_ROUTE].indexOf(newState) < 0) ? 'none' : 'initial';\r\n\r\n    document.getElementById('btnPutMouse').disabled = document.getElementById('cheese').style.display === 'none';\r\n    document.getElementById('btnPlay').disabled = document.getElementById('mouse').style.display === 'none';\r\n\r\n    mouse.playing = newState === STATE_PLAY_ROUTE;\r\n}\r\n\r\nfunction setState(state) {\r\n    let oldState = gameState;\r\n    gameState = state;\r\n    console.log('state' + oldState + '>' + state);\r\n    if (oldState !== state) {\r\n        onStateChanged(state);\r\n    }\r\n}\r\n\r\n","'use strict';\r\n\r\nexport class Mouse {\r\n    constructor(updateMouseView) {\r\n        this.updateMouseView = updateMouseView;\r\n        this.position = [0, 0];\r\n        this.direction = 'UP';\r\n        this.playing = false;\r\n    }\r\n\r\n    put(column, row, direction) {\r\n        this.position = [column, row];\r\n        this.direction = direction;\r\n        this.updateMouseView(column, row, direction);\r\n    }\r\n\r\n    play(map, cheese, program, onWin, onLose) {\r\n        this.playing = true;\r\n        let self = this;\r\n        let f = function () {\r\n            if (self.playing) {\r\n                if (cheese[0] === self.position[0] && cheese[1] === self.position[1]) {\r\n                    self.playing = false;\r\n                    onWin();\r\n                } else if (program.length === 0) {\r\n                    self.playing = false;\r\n                    onLose();\r\n                }\r\n                let command = program.shift();\r\n                let col = self.position[0];\r\n                let row = self.position[1];\r\n                let dir = command;\r\n                if (command === 'UP') {\r\n                    row -= 1;\r\n                } else if (command === 'DN') {\r\n                    row += 1;\r\n                } else if (command === 'LT') {\r\n                    col -= 1;\r\n                } else if (command === 'RT') {\r\n                    col += 1;\r\n                }\r\n                if (map.isLand(col, row) && map.hasRoute(self.position, [col, row])) {\r\n                    self.put(col, row, dir);\r\n                    setTimeout(f, 1000);\r\n                } else {\r\n                    self.playing = false;\r\n                    onLose();\r\n                }\r\n            }\r\n        };\r\n        setTimeout(f, 1000);\r\n    }\r\n}","'use strict';\r\n\r\nimport {buildKey, swap} from \"./utils\";\r\n\r\nexport class Map {\r\n\r\n    constructor(size, onCellStatusChanged) {\r\n        this.size = size;\r\n        this.cells = new Set();\r\n        this.borders = new Set();\r\n        this.onCellStatusChanged = onCellStatusChanged;\r\n    }\r\n\r\n    swapRightBorder(row, leftCellColumn, rightCellColumn) {\r\n        console.log('swapRightBorder ' + leftCellColumn + '>' + rightCellColumn + ':' + row);\r\n        swap(this.borders, 'fRow' + row, leftCellColumn, rightCellColumn);\r\n        this.onCellStatusChanged.call(undefined, leftCellColumn, row,\r\n            this.cells.has(buildKey('column' + leftCellColumn, 'row' + row)),\r\n            this.borders.has(buildKey('fRow' + row, leftCellColumn, rightCellColumn)),\r\n            this.borders.has(buildKey('fCol' + leftCellColumn, row, row + 1))\r\n        );\r\n    }\r\n\r\n    swapBottomBorder(column, topCellRow, bottomCellRow) {\r\n        console.log('swapBottomBorder ' + column + ':' + topCellRow + '>' + bottomCellRow);\r\n        swap(this.borders, 'fCol' + column, topCellRow, bottomCellRow);\r\n        this.onCellStatusChanged.call(undefined, column, topCellRow,\r\n            this.cells.has(buildKey('column' + column, 'row' + topCellRow)),\r\n            this.borders.has(buildKey('fRow' + topCellRow, column, column + 1)),\r\n            this.borders.has(buildKey('fCol' + column, topCellRow, bottomCellRow))\r\n        );\r\n    }\r\n\r\n    swapCell(column, row) {\r\n        console.log('swapCell ' + column + ':' + row);\r\n        swap(this.cells, 'column' + column, 'row' + row);\r\n        this.onCellStatusChanged.call(undefined, column, row,\r\n            this.cells.has(buildKey('column' + column, 'row' + row)),\r\n            this.borders.has(buildKey('fRow' + row, column, column + 1)),\r\n            this.borders.has(buildKey('fCol' + column, row, row + 1))\r\n        );\r\n    }\r\n\r\n    clear() {\r\n        this.cells = new Set();\r\n        this.borders = new Set();\r\n        for (let i = 0; i < this.size; i++) {\r\n            for (let j = 0; j < this.size; j++) {\r\n                this.onCellStatusChanged.call(undefined, i, j, false, false, false);\r\n            }\r\n        }\r\n    }\r\n\r\n    isLand(column, row) {\r\n        return this.cells.has(buildKey('column' + column, 'row' + row));\r\n    }\r\n\r\n    hasRoute(from, to) {\r\n        return !this.borders.has(buildKey('fRow' + from[1], from[0], to[0]))\r\n            &&\r\n            !this.borders.has(buildKey('fCol' + from[0], from[1], to[1]));\r\n    }\r\n}\r\n\r\n\r\n\r\n"],"names":["$c7997aef068a9f19$var$buildKey","keys","sort","a","b","isNaN","String","localeCompare","join","$c7997aef068a9f19$exports","buildKey","swap","set","key","delete","add","$f7fca9471e720bd1$var$STATE_MAIN_MENU","$f7fca9471e720bd1$var$STATE_CONSTRUCTION_MAP","$f7fca9471e720bd1$var$STATE_CONSTRUCTION_MOUSE","$f7fca9471e720bd1$var$STATE_CONSTRUCTION_CHEESE","$f7fca9471e720bd1$var$STATE_PROGRAM_ROUTE","$f7fca9471e720bd1$var$STATE_PLAY_ROUTE","$f7fca9471e720bd1$var$divMap","document","getElementById","$f7fca9471e720bd1$var$divProgramPanel","$f7fca9471e720bd1$var$imgMouse","$f7fca9471e720bd1$var$imgCheese","$f7fca9471e720bd1$var$gameState","$f7fca9471e720bd1$var$program","$f7fca9471e720bd1$var$cheese","$f7fca9471e720bd1$var$originalPosition","$f7fca9471e720bd1$var$mouse","constructor","updateMouseView","this","position","direction","playing","put","column","row","play","map","cheese","program","onWin","onLose","self","f","length","command","shift","col","dir","isLand","hasRoute","setTimeout","rect","getBoundingClientRect","style","top","height","left","width","display","transform","$f7fca9471e720bd1$var$map","size","onCellStatusChanged","cells","Set","borders","swapRightBorder","leftCellColumn","rightCellColumn","console","log","call","undefined","has","swapBottomBorder","topCellRow","bottomCellRow","swapCell","clear","i","j","from","to","state","rightBorderState","bottomBorderState","cell","children","classList","remove","$f7fca9471e720bd1$var$MAP_SIZE","cellDiv","createElement","className","appendChild","$f7fca9471e720bd1$var$addCommand","commandName","e","push","img","src","target","$f7fca9471e720bd1$var$resetProgram","innerHTML","$f7fca9471e720bd1$var$setState","$f7fca9471e720bd1$var$onStateChanged","newState","visibility","indexOf","controlBtns","getElementsByClassName","Array","forEach","el","disabled","oldState","addEventListener","bind","alert","event","pop","removeChild","x","clientX","y","clientY","cellX","cellY","Math","trunc","abs","round"],"version":3,"file":"index.ad35d094.js.map"}