var e={};function t(...e){return e.sort(((e,t)=>isNaN(e)?isNaN(t)?String(e).localeCompare(t):-1:isNaN(t)?1:e-t)).join("-")}e={buildKey:t,swap:function(e,...n){let l=t(...n);e.delete(l)||e.add(l)}};const n="MAIN_MENU",l="CONSTRUCTION_MAP",i="CONSTRUCTION_MOUSE",s="CONSTRUCTION_CHEESE",o="PROGRAM_ROUTE",d="PLAY_ROUTE";let a=document.getElementById("map"),c=document.getElementById("programPanel"),r=document.getElementById("mouse"),u=document.getElementById("cheese"),m=n,h=[],y=[-1,-1],g=[-1,-1],p=new class{constructor(e){this.updateMouseView=e,this.position=[0,0],this.direction="UP",this.playing=!1}put(e,t,n){this.position=[e,t],this.direction=n,this.updateMouseView(e,t,n)}play(e,t,n,l,i){this.playing=!0;let s=this,o=function(){if(s.playing){t[0]===s.position[0]&&t[1]===s.position[1]?(s.playing=!1,l()):0===n.length&&(s.playing=!1,i());let d=n.shift(),a=s.position[0],c=s.position[1],r=d;"UP"===d?c-=1:"DN"===d?c+=1:"LT"===d?a-=1:"RT"===d&&(a+=1),e.isLand(a,c)&&e.hasRoute(s.position,[a,c])?(s.put(a,c,r),setTimeout(o,1e3)):(s.playing=!1,i())}};setTimeout(o,1e3)}}((function(e,t,n){let l=document.getElementById("movingArea").getBoundingClientRect();r.style.top=(t+.5)*(l.height/10)+"px",r.style.left=(e+.5)*(l.width/10)+"px",r.style.display="initial","UP"===n?r.style.transform="rotate(180deg)":"DN"===n?r.style.transform="rotate(0deg)":"LT"===n?r.style.transform="rotate(90deg)":"RT"===n&&(r.style.transform="rotate(270deg)")})),b=new class{constructor(e,t){this.size=e,this.cells=new Set,this.borders=new Set,this.onCellStatusChanged=t}swapRightBorder(t,n,l){console.log("swapRightBorder "+n+">"+l+":"+t),e.swap(this.borders,"fRow"+t,n,l),this.onCellStatusChanged.call(void 0,n,t,this.cells.has(e.buildKey("column"+n,"row"+t)),this.borders.has(e.buildKey("fRow"+t,n,l)),this.borders.has(e.buildKey("fCol"+n,t,t+1)))}swapBottomBorder(t,n,l){console.log("swapBottomBorder "+t+":"+n+">"+l),e.swap(this.borders,"fCol"+t,n,l),this.onCellStatusChanged.call(void 0,t,n,this.cells.has(e.buildKey("column"+t,"row"+n)),this.borders.has(e.buildKey("fRow"+n,t,t+1)),this.borders.has(e.buildKey("fCol"+t,n,l)))}swapCell(t,n){console.log("swapCell "+t+":"+n),e.swap(this.cells,"column"+t,"row"+n),this.onCellStatusChanged.call(void 0,t,n,this.cells.has(e.buildKey("column"+t,"row"+n)),this.borders.has(e.buildKey("fRow"+n,t,t+1)),this.borders.has(e.buildKey("fCol"+t,n,n+1)))}clear(){this.cells=new Set,this.borders=new Set;for(let e=0;e<this.size;e++)for(let t=0;t<this.size;t++)this.onCellStatusChanged.call(void 0,e,t,!1,!1,!1)}isLand(t,n){return this.cells.has(e.buildKey("column"+t,"row"+n))}hasRoute(t,n){return!this.borders.has(e.buildKey("fRow"+t[1],t[0],n[0]))&&!this.borders.has(e.buildKey("fCol"+t[0],t[1],n[1]))}}(10,(function(e,t,n,l,i){let s=a.children[10*t+e];n?s.classList.add("land"):s.classList.remove("land"),l?s.classList.add("rb"):s.classList.remove("rb"),i?s.classList.add("bb"):s.classList.remove("bb")}));for(let e=0;e<100;e++){let e=document.createElement("div");e.className="cell",a.appendChild(e)}function E(e,t){0===h.length&&p.put(g[0],g[1],e),h.push(e);let n=document.createElement("img");n.src=t.target.src?t.target.src:t.target.children[0].src,c.appendChild(n)}function f(){h=[],c.innerHTML="",p.put(g[0],g[1],"UP"),w(o)}function B(e){console.log("onStateChanged"),document.getElementById("btnMM").style.visibility="visible",document.getElementById("btnBuildLevel").style.display=[n].indexOf(e)<0?"none":"initial",document.getElementById("btnPutCheese").style.display=[l].indexOf(e)<0?"none":"initial",document.getElementById("btnPutMouse").style.display=[s].indexOf(e)<0?"none":"initial",document.getElementById("btnPlay").style.display=[i].indexOf(e)<0?"none":"initial",document.getElementById("btnReset").style.display=[o,d].indexOf(e)<0?"none":"initial",document.getElementById("btnGo").style.display=[o].indexOf(e)<0?"none":"initial";let t=document.getElementsByClassName("control-btns");Array.from(t).forEach((t=>t.disabled=e!==o)),document.getElementById("cheese").style.display=-1===y[0]||[s,i,o,d].indexOf(e)<0?"none":"initial",document.getElementById("mouse").style.display=-1===g[0]||[i,o,d].indexOf(e)<0?"none":"initial",document.getElementById("btnPutMouse").disabled="none"===document.getElementById("cheese").style.display,document.getElementById("btnPlay").disabled="none"===document.getElementById("mouse").style.display,p.playing=e===d}function w(e){let t=m;m=e,console.log("state"+t+">"+e),t!==e&&B(e)}document.getElementById("btnMM").addEventListener("click",(function(){h=[],y=[-1,-1],g=[-1,-1],c.innerHTML="",b.clear(),w(n)})),document.getElementById("btnBuildLevel").addEventListener("click",w.bind(void 0,l)),document.getElementById("btnPutCheese").addEventListener("click",w.bind(void 0,s)),document.getElementById("btnPutMouse").addEventListener("click",w.bind(void 0,i)),document.getElementById("btnPlay").addEventListener("click",f),document.getElementById("btnReset").addEventListener("click",f),document.getElementById("btnGo").addEventListener("click",(function(){p.play(b,y,h,(function(){alert("Win"),f()}),(function(){alert("Lose"),f()}))})),document.getElementById("btnUp").addEventListener("click",(e=>E("UP",e))),document.getElementById("btnLeft").addEventListener("click",(e=>E("LT",e))),document.getElementById("btnRight").addEventListener("click",(e=>E("RT",e))),document.getElementById("btnDown").addEventListener("click",(e=>E("DN",e))),document.getElementById("btnRemoveLast").addEventListener("click",(function(){h.length>0&&(h.pop(),c.removeChild(c.children[c.children.length-1]))})),document.getElementById("movingArea").addEventListener("click",(function(e){let t=a.getBoundingClientRect(),n=e.clientX-t.left,o=e.clientY-t.top,d=n/(t.width/10),c=o/(t.height/10);console.log("X? : "+n+" ; Y? : "+o),console.log("cellX? : "+d+" ; cellY? : "+c);let r=Math.trunc(d),h=Math.trunc(c);if(console.log("col? : "+r+" ; row? : "+h),m===l)console.log("change map"),Math.abs(Math.round(d)-d)<.1&&Math.abs(Math.round(c)-c)<.1||(Math.abs(Math.round(d)-d)<.1?d>0&&d-r<.5?b.swapRightBorder(h,r-1,r):d<9&&d-r>.5&&b.swapRightBorder(h,r,r+1):Math.abs(Math.round(c)-c)<.1?c>0&&c-h<.5?b.swapBottomBorder(r,h-1,h):c<9&&c-h>.5&&b.swapBottomBorder(r,h,h+1):b.swapCell(r,h));else if(m===s){if(console.log("change cheese position"),b.isLand(r,h)){let e=document.getElementById("movingArea").getBoundingClientRect();y=[r,h],u.style.display="initial",u.style.top=(h+.5)*(e.height/10)+"px",u.style.left=(r+.5)*(e.width/10)+"px"}B(s)}else m===i&&(console.log("change mouse position"),b.isLand(r,h)&&(g=[r,h],p.put(r,h,"UP")),B(i))})),B(m);
//# sourceMappingURL=index.ad35d094.js.map
